---
title: "Trabajo Reglas Asociación"
author: "Juan José Sierra González"
date: "27 de enero de 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

En este trabajo final sobre **reglas de asociación** se ha seleccionado un dataset sobre el que trabajar obteniendo reglas que resulten de interés y que aporten información a los datos que ya se poseen. A continuación se estudiarán los itemsets frecuentes, maximales y cerrados, se obtendrán las reglas correspondientes al mínimo soporte establecido, y en general se hará uso de las técnicas aprendidas durante el curso para así alcanzar el objetivo de la práctica.

## Carga de librerías

En primer lugar es necesario cargar las librerías necesarias para trabajar con reglas de asociación. En el caso de este trabajo se van a utilizar las siguientes. 

```{r}
library(arules)
library(arulesViz)
library(pmml)
library(mlbench)
```

## Lectura de los datos

El dataset que se ha escogido para desarrollar este trabajo ha sido _Contraceptive Method Choice_ (https://archive.ics.uci.edu/ml/datasets/Contraceptive+Method+Choice), obtenido del repositorio de datasets de la Universidad de California-Irvine. Este conjunto de datos determina el método anticonceptivo elegido por una pareja, que puede ser ninguno, a corto plazo o a largo plazo. Las mujeres que forman parte de este conjunto son mujeres casadas que no estaban embarazadas o no lo sabían en el momento de la recopilación de los datos, según la información del propio dataset.

```{r}
Contraceptive = read.csv("./Datos/cmc.data", header = FALSE)
head(Contraceptive)
```

Para dar un nombre adecuado a cada variable se va a utilizar la información extraída del archivo `cmc.names`. De esta forma también se le dará una nomenclatura adecuada a los valores que puede tomar cada una de las características, convirtiéndolas en un factor cuando sea necesario. Se tienen en cuenta datos sobre cada uno de los integrantes de la pareja y sobre la familia en general.

Estas son las variables que contiene este dataset:

- **Wife's age** → La edad de la mujer.

- **Wife's education** → La formación académica de la mujer.

- **Husband's education** → La formación académica del hombre.

- **Children** → La cantidad de hijos que ha tenido la pareja.

- **Wife's religion** → La mujer es de religión musulmana o no.

- **Wife working** → La mujer se encuentra trabajando o no.

- **Husband's occupation** → Trabajo del hombre.

- **Standard-of-living** → Nivel de vida de la familia.

- **Media exposure** → Exposición a los medios (tienen buena cobertura mediática o no).

- **Contraceptive method** → Método anticonceptivo utilizado.

```{r}
colnames(Contraceptive) = c("Wife's age",
				"Wife's education", "Husband's education",
				"Children", "Wife's religion", "Wife working",
				"Husband's occupation", "Standard-of-living",
				"Media exposure", "Contraceptive method")

# Wife's age
# Se establecen unos rangos de edad que puedan dividir a la población
Contraceptive[,1] = cut(Contraceptive[,1], c(16,24,32,40,50), right = FALSE,
              labels = c("Young", "Mid-age", "Adult", "Old"))

# Wife's education
Contraceptive[,2] = ordered(Contraceptive[,2], levels = 1:4,
							labels = c("Low", "Mid-low", "Mid-high", "High"))

# Husband's education
Contraceptive[,3] = ordered(Contraceptive[,3], levels = 1:4,
							labels = c("Low", "Mid-low", "Mid-high", "High"))

# Number of born children
Contraceptive[,4] = cut(Contraceptive[,4], c(0,1,3,5,8,20), right = FALSE,
              labels = c("0", "1-2", "3-4", "5-8", "9+"))

# Wife's religion
Contraceptive[,5] = factor(Contraceptive[,5], levels = 0:1,
							labels = c("Non-Islam", "Islam"))

# Wife working
Contraceptive[,6] = factor(Contraceptive[,6], levels = 0:1,
							labels = c("Yes", "No"))
							# ?No es un error! "0" significa "sí" en esta variable...

# Husband's occupation (?no especificado por el dataset!)
Contraceptive[,7] = ordered(Contraceptive[,7], levels = 1:4,
							labels = c("Low", "Mid-low", "Mid-high", "High"))

# Standard-of-living
Contraceptive[,8] = ordered(Contraceptive[,8], levels = 1:4,
							labels = c("Low", "Mid-low", "Mid-high", "High"))

# Media exposure
Contraceptive[,9] = factor(Contraceptive[,9], levels = 0:1,
							labels = c("Good", "Not good"))

# Contraceptive method
Contraceptive[,10] = factor(Contraceptive[,10], levels = 1:3,
							labels = c("No-use", "Long-term", "Short-term"))
```

Cabe destacar que para la variable "Husband's occupation" no se especifica en la información del dataset el significado de los distintos valores, por lo que si aparece en futuras reglas o itemsets se tratarán estos valores de forma similar al resto de variables, siendo 1 el de valor más bajo y 4 el más alto.

Se puede echar un vistazo a los valores más comunes del dataset utilizando la función `summary`:

```{r}
summary(Contraceptive)
```

En este resumen obtenido se observan los valores más frecuentes para cada variable. En general se puede observar que se trata de una población mayoritariamente musulmana donde hay bastante propensidad a tener hijos. El resto de detalles del dataset se analizarán cuando se obtengan los itemsets frecuentes y las reglas.

Ahora los datos son más legibles e interpretables, y se puede proceder a realizar un análisis más profundo y comenzar extrayendo itemsets frecuentes.

## Transacciones e itemsets de interés

En primer lugar se van a crear las transacciones para la base de datos ya modificada. Para ello se utiliza la función `as`, indicando "transactions" como parámetro a convertir.

```{r}
ContraceptiveT = as(Contraceptive, "transactions")
summary(ContraceptiveT)
```

